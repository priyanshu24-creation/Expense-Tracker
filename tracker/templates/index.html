{% load static %}
<!DOCTYPE html>
<html>
<head>
<title>Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--primary:#4f46e5;
--secondary:#3b82f6;
--accent:#22c55e;
--bg:#f4f7fb;
--card:#ffffff;
--shadow:0 15px 35px rgba(0,0,0,.12);
}

*{box-sizing:border-box;}
body{
margin:0;
font-family:"Segoe UI",sans-serif;
background:linear-gradient(120deg,#eef2ff,#f8fafc);
color:#1e293b;
}

/* TOP BAR */
.topbar{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 8px 25px rgba(0,0,0,.25);
}
.logo{font-size:22px;font-weight:bold;}
.slogan{font-size:12px;opacity:.9;}
.user-area{display:flex;align-items:center;gap:10px;font-weight:600;}
#profilePic{
width:42px;height:42px;border-radius:50%;
border:3px solid white;
cursor:pointer;
transition:.3s;
}
#profilePic:hover{transform:scale(1.1) rotate(5deg);}

/* CONTAINER */
.container{
padding:25px;
max-width:1200px;
margin:auto;
animation:fadeUp .7s ease;
}

/* FORM */
.form-card{
background:white;
padding:15px;
border-radius:18px;
box-shadow:var(--shadow);
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:15px;
transition:.3s;
}
.form-card:hover{transform:translateY(-5px);}
.form-card input,.form-card select{
padding:10px;border-radius:10px;border:1px solid #ccc;
}
.form-card button{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;border:none;padding:10px 20px;
border-radius:12px;cursor:pointer;
transition:.3s;
}
.form-card button:hover{transform:scale(1.05);}

/* FILTER */
.filter-card{
background:white;
padding:12px;
border-radius:16px;
box-shadow:var(--shadow);
margin-bottom:15px;
}

/* STATS */
.stats{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:15px;
margin-bottom:20px;
}
.card{
padding:22px;
border-radius:18px;
text-align:center;
font-weight:bold;
font-size:17px;
box-shadow:var(--shadow);
transition:.3s;
}
.card:hover{transform:translateY(-6px);}
.card:nth-child(1){background:#dcfce7;color:#166534;}
.card:nth-child(2){background:#fee2e2;color:#991b1b;}
.card:nth-child(3){background:#e0e7ff;color:#3730a3;}
.count{font-size:24px;display:block;margin-top:6px;}

/* LIST */
ul{list-style:none;padding:0;}
li{
background:white;
margin-bottom:10px;
padding:14px;
border-radius:14px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 6px 15px rgba(0,0,0,.1);
transition:.3s;
}
li:hover{transform:translateX(8px);}
li a{color:red;text-decoration:none;font-weight:bold;}

/* CHART */
.chart-box{
background:white;
padding:20px;
border-radius:22px;
box-shadow:var(--shadow);
max-width:450px;
margin:30px auto;
}

/* OVERLAY */
.drawer-overlay{
position:fixed;inset:0;
background:rgba(0,0,0,.4);
opacity:0;pointer-events:none;
transition:.3s;z-index:999;
}
.drawer-overlay.show{opacity:1;pointer-events:all;}

/* DRAWER */
.profile-drawer{
position:fixed;top:0;right:0;
width:300px;height:100vh;
background:white;
box-shadow:-4px 0 20px rgba(0,0,0,.25);
transform:translateX(100%);
transition:.35s;
z-index:1000;
padding:20px;
}
.profile-drawer.open{transform:translateX(0);}
.profile-header{text-align:center;}
.profile-img{
width:80px;height:80px;border-radius:50%;
border:3px solid var(--primary);
object-fit:cover;
}
.close-btn{float:right;font-size:22px;cursor:pointer;}
.profile-menu li{border-bottom:1px solid #ddd;padding:10px;}
.profile-menu a{text-decoration:none;color:#1e293b;font-weight:600;}

/* FOOTER */
footer{
margin-top:40px;
padding:15px;
text-align:center;
background:#1e293b;
color:white;
}

/* ANIMATIONS */
@keyframes fadeUp{
from{opacity:0;transform:translateY(20px);}
to{opacity:1;transform:translateY(0);}
}
</style>
</head>

<body>

<div class="topbar">
<div>
<div class="logo">ðŸ’° Expense Tracker</div>
<div class="slogan">Track every rupee. Control your future.</div>
</div>
<div class="user-area">
{{ request.user.username }}
<img id="profilePic" src="{{ request.user.profile.image.url }}">
</div>
</div>

<div class="container">

<form method="POST" class="form-card">
{% csrf_token %}
<select name="type"><option>Income</option><option>Expense</option></select>
<input type="number" name="amount" placeholder="Amount" required>
<select name="category">
<option>Food</option><option>Transport</option><option>Rent</option>
<option>Shopping</option><option>Salary</option><option>Other</option>
</select>
<input type="date" name="date" required>
<button>Add</button>
</form>

<form method="GET" class="filter-card">
<input type="month" name="month" value="{{ selected_month }}">
<button>Filter</button>
</form>

<div class="stats">
<div class="card">ðŸ’° Income <span class="count">{{ total_income }}</span></div>
<div class="card">ðŸ§¾ Expense <span class="count">{{ total_expense }}</span></div>
<div class="card">âš– Balance <span class="count">{{ balance }}</span></div>
</div>

<ul>
{% for t in transactions %}
<li>
<span>{{ t.date }} | {{ t.get_category_display }} | {{ t.type }}</span>
<span>â‚¹{{ t.amount }} <a href="/delete/{{ t.id }}/">âœ–</a></span>
</li>
{% endfor %}
</ul>

{% if chart_values %}
<div class="chart-box">
<canvas id="expenseChart"></canvas>
</div>
<script>
const labels = JSON.parse('{{ chart_labels|escapejs }}');
const values = JSON.parse('{{ chart_values|escapejs }}');
new Chart(document.getElementById('expenseChart'),{
type:'pie',
data:{labels:labels,datasets:[{data:values}]},
options:{plugins:{legend:{position:'bottom'}}}
});
</script>
{% endif %}

</div>

<div id="drawerOverlay" class="drawer-overlay"></div>

<div id="profileDrawer" class="profile-drawer">
<div class="profile-header">
<span class="close-btn" id="closeBtn">Ã—</span>
<img src="{{ request.user.profile.image.url }}" class="profile-img">
<h3>{{ request.user.username }}</h3>
<p>{{ request.user.profile.full_name }}</p>
</div>
<ul class="profile-menu">
<li><a href="{% url 'profile' %}">View Profile</a></li>
<li><a href="{% url 'edit_profile' %}">Edit Profile</a></li>
<li><a href="{% url 'password_change' %}">Change Password</a></li>
<form method="post" action="{% url 'logout' %}">{% csrf_token %}
<button style="color:red;background:none;border:none;font-weight:bold;">Logout</button>
</form>
</ul>
</div>

<footer>
This website made by Priyanshu Chatterjee BN Â© 2024
</footer>

<script>
const drawer=document.getElementById("profileDrawer");
const overlay=document.getElementById("drawerOverlay");
const pic=document.getElementById("profilePic");
const closeBtn=document.getElementById("closeBtn");

/* force closed */
drawer.classList.remove("open");
overlay.classList.remove("show");

pic.addEventListener("click",()=>{
drawer.classList.add("open");
overlay.classList.add("show");
});
overlay.addEventListener("click",()=>{
drawer.classList.remove("open");
overlay.classList.remove("show");
});
closeBtn.addEventListener("click",()=>{
drawer.classList.remove("open");
overlay.classList.remove("show");
});

/* count animation */
document.querySelectorAll(".count").forEach(el=>{
let target=parseInt(el.innerText)||0;
let c=0,step=Math.max(1,Math.ceil(target/40));
let i=setInterval(()=>{
c+=step;
if(c>=target){c=target;clearInterval(i);}
el.innerText=c;
},25);
});
</script>

</body>
</html>
