{% load static %}
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Expense Tracker</title>
<link rel="icon" type="image/png" href="{% static 'tracker/logo.png' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
--primary:#4f46e5;
--secondary:#3b82f6;
--green:#059669;
--red:#dc2626;
}

*{box-sizing:border-box;}
body{
margin:0;
font-family:Poppins,sans-serif;
background:linear-gradient(135deg,#eef2ff,#f8fafc);
color:#0f172a;
}

/* TOPBAR */
.topbar{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 8px 25px rgba(0,0,0,.25);
}

.logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:20px;}
.logo-img{width:36px;height:36px;border-radius:50%;background:white;padding:2px;}
.logo-stack{display:flex;flex-direction:column;line-height:1.1;}
.logo-title{font-weight:700;font-size:20px;}
.logo-slogan{font-size:12px;font-weight:500;opacity:.9;}

.user-link{
display:flex;
align-items:center;
gap:0;
cursor:pointer;
font-weight:600;
background:transparent;
border:0;
padding:2px;
color:white;
}
.user-link:focus-visible{
outline:2px solid rgba(255,255,255,.8);
outline-offset:2px;
border-radius:999px;
}
.user-avatar{
width:36px;height:36px;border-radius:50%;
border:2px solid rgba(255,255,255,.8);
background-position:center;
background-repeat:no-repeat;
background-size:cover;
background-color:#ffffff;
flex:0 0 auto;
}

.auth-btn{
background:white;color:var(--primary);
padding:8px 18px;border-radius:20px;border:none;
font-weight:600;cursor:pointer;
text-decoration:none;display:inline-block;
}

@media (max-width: 600px){
.topbar{
display:grid;
grid-template-columns:1fr auto;
gap:8px 12px;
padding:12px 14px;
align-items:center;
}
.logo{gap:8px;min-width:0;}
.logo-stack{min-width:0;}
.logo-title{font-size:18px;line-height:1.1;}
.logo-slogan{
font-size:11px;
line-height:1.2;
white-space:nowrap;
overflow:hidden;
text-overflow:ellipsis;
max-width:62vw;
}
.user-link{
justify-self:end;
gap:6px;
font-size:13px;
}
.user-avatar{width:32px;height:32px;}
.container{padding:12px;margin:18px auto;}
.balance-container{padding:18px;}
.balance-container h1{font-size:30px;}
.summary{grid-template-columns:1fr;}
.filter-bar{align-items:stretch;}
.filter-form{width:100%;}
.filter-form label{width:100%;}
.filter-form input[type="month"],
.filter-form button{width:100%;}
.filter-clear{width:100%;text-align:center;}
.form-card{grid-template-columns:1fr;}
.form-card input,.form-card select,.form-card button{width:100%;}
li{flex-direction:column;align-items:flex-start;gap:6px;}
li span:last-child{align-self:flex-end;}
.chart-box{max-width:100%;margin:20px 0;}
.hero{
grid-template-columns:1fr;
}
.hero-title{font-size:26px;}
.overview-card{padding:14px;}
.overview-metric span{font-size:24px;}
.showcase-grid{grid-template-columns:1fr;}
.showcase-panel{padding:14px;}
}


/* CONTAINER */
.container{
max-width:1100px;
margin:30px auto;
padding:24px;
}

/* HERO / LANDING */
.hero{
display:grid;
grid-template-columns:1.1fr .9fr;
gap:24px;
align-items:center;
margin:10px 0 26px;
}
.hero-title{
font-size:34px;
line-height:1.15;
margin:0 0 10px;
color:#0f172a;
}
.hero-lead{
margin:0 0 16px;
color:#475569;
font-size:15px;
}
.hero-actions{
display:flex;
gap:12px;
flex-wrap:wrap;
}
.cta-btn{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
padding:12px 20px;
border-radius:999px;
text-decoration:none;
font-weight:600;
display:inline-flex;
align-items:center;
justify-content:center;
}
.ghost-btn{
background:white;
color:#1e293b;
padding:12px 18px;
border-radius:999px;
text-decoration:none;
font-weight:600;
border:1px solid #e2e8f0;
}
.preview-pill{
display:inline-flex;
align-items:center;
gap:6px;
background:#eef2ff;
color:#3730a3;
font-weight:600;
font-size:12px;
padding:6px 10px;
border-radius:999px;
margin-bottom:10px;
}
.overview-card{
background:white;
border-radius:18px;
box-shadow:0 12px 28px rgba(0,0,0,.12);
padding:18px;
display:flex;
flex-direction:column;
gap:14px;
}
.overview-header{
display:flex;
align-items:center;
justify-content:space-between;
}
.overview-title{
font-weight:700;
font-size:16px;
color:#0f172a;
}
.overview-chip{
font-size:11px;
padding:6px 10px;
border-radius:999px;
background:#f1f5f9;
color:#0f172a;
font-weight:600;
}
.overview-metric{
display:flex;
align-items:flex-end;
gap:10px;
}
.overview-metric span{
font-size:28px;
font-weight:700;
color:#0f172a;
}
.overview-metric small{
color:#64748b;
font-size:12px;
}
.overview-list{
display:flex;
flex-direction:column;
gap:10px;
}
.overview-row{
display:flex;
align-items:center;
justify-content:space-between;
padding:10px 12px;
border-radius:12px;
background:#f8fafc;
border:1px solid #e2e8f0;
font-size:12px;
}
.overview-row b{font-weight:600;}
.overview-badge{
padding:4px 8px;
border-radius:999px;
font-size:11px;
font-weight:600;
}
.badge-income{background:#ecfdf3;color:#0f766e;}
.badge-expense{background:#fef2f2;color:#b91c1c;}

/* DECOR SECTION */
.auth-section{
background:white;
padding:20px;
border-radius:18px;
box-shadow:0 10px 30px rgba(0,0,0,.12);
margin:26px 0;
}
.showcase-grid{
display:grid;
grid-template-columns:1.2fr .8fr;
gap:18px;
align-items:stretch;
}
.showcase-lead{
margin:0 0 14px;
color:#64748b;
font-size:13px;
}
.showcase-steps{
display:grid;
gap:10px;
}
.showcase-step{
display:flex;
gap:10px;
padding:12px;
border-radius:12px;
background:#f8fafc;
border:1px solid #e2e8f0;
}
.step-num{
width:28px;height:28px;border-radius:50%;
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;font-weight:700;font-size:13px;
display:flex;align-items:center;justify-content:center;
flex:0 0 auto;
}
.showcase-step p{
margin:4px 0 0;
font-size:12px;
color:#64748b;
}
.showcase-panel{
background:linear-gradient(135deg,#eef2ff,#f8fafc);
border-radius:16px;
padding:16px;
display:flex;
flex-direction:column;
gap:12px;
}
.panel-title{
font-weight:700;
font-size:15px;
color:#0f172a;
}
.panel-metric{
display:flex;
align-items:flex-end;
gap:8px;
}
.panel-metric span{
font-size:24px;
font-weight:700;
color:#0f172a;
}
.panel-metric small{
font-size:12px;
color:#64748b;
}
.panel-list{
display:grid;
gap:8px;
}
.panel-row{
display:flex;
align-items:center;
justify-content:space-between;
padding:8px 10px;
border-radius:12px;
background:white;
border:1px solid #e2e8f0;
font-size:12px;
}
.panel-chip{
background:#e0f2fe;
color:#0369a1;
padding:3px 8px;
border-radius:999px;
font-size:11px;
font-weight:600;
}
.security-badges{
display:flex;
flex-wrap:wrap;
gap:8px;
}
.security-badge{
background:#f1f5f9;
color:#0f172a;
padding:6px 10px;
border-radius:999px;
font-size:11px;
font-weight:600;
}

/* BALANCE CARD */
.balance-container{
text-align:center;
margin-bottom:28px;
padding:26px;
border-radius:18px;
background:linear-gradient(135deg,#a8d5ba,#6b8e23);
color:#0b2e13;
box-shadow:0 10px 30px rgba(0,0,0,.15);
}
.balance-container h1{
font-size:40px;
margin:10px 0 18px;
}

.summary{
display:grid;
grid-template-columns:1fr 1fr;
gap:18px;
}
.summary-box{
background:white;
padding:18px;
border-radius:14px;
box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.summary-box p{font-size:22px;font-weight:700;margin:6px 0 0;}
.income p{color:var(--green);}
.expense p{color:var(--red);}

/* FILTER */
.filter-bar{
display:flex;
justify-content:space-between;
align-items:flex-end;
gap:12px;
margin:0 0 18px;
flex-wrap:wrap;
}
.filter-form{
display:flex;
align-items:center;
gap:10px;
flex-wrap:wrap;
}
.filter-form label{font-size:13px;font-weight:600;color:#334155;}
.filter-form input[type="month"]{
padding:9px 10px;border-radius:10px;border:1px solid #e2e8f0;
}
.filter-form button{
background:#111827;color:white;border:none;border-radius:10px;
padding:9px 14px;font-weight:600;cursor:pointer;
}
.filter-clear{
color:#0f172a;text-decoration:none;font-weight:600;
padding:9px 12px;border-radius:10px;border:1px solid #e2e8f0;background:#f8fafc;
}

/* FORM */
.form-card{
background:white;
padding:18px;
border-radius:16px;
box-shadow:0 10px 25px rgba(0,0,0,.1);
display:grid;
grid-template-columns:repeat(5,1fr);
gap:12px;
margin-bottom:18px;
}
.form-card input,.form-card select{
padding:10px;border-radius:10px;border:1px solid #e2e8f0;
}
.form-card button{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;border:none;border-radius:12px;font-weight:600;
}

/* LIST */
ul{list-style:none;padding:0;}
li{
background:white;
padding:14px;
border-radius:14px;
margin-bottom:10px;
display:flex;
justify-content:space-between;
box-shadow:0 6px 15px rgba(0,0,0,.08);
border-right:5px solid;
}
li.income{border-color:var(--green);}
li.expense{border-color:var(--red);}

/* CHART */
.chart-box{
background:white;
padding:20px;
border-radius:18px;
box-shadow:0 10px 30px rgba(0,0,0,.12);
max-width:420px;
margin:30px auto;
}

/* PROFILE DRAWER */
.drawer-scrim{
position:fixed;inset:0;
background:rgba(0,0,0,.4);
opacity:0;pointer-events:none;
transition:.25s;
z-index:1000;
}
.drawer-scrim.open{opacity:1;pointer-events:auto;}

.drawer{
position:fixed;
right:0;top:0;height:100%;
width:320px;
background:white;
box-shadow:-10px 0 30px rgba(0,0,0,.2);
display:none;
z-index:1001;
padding:20px;
flex-direction:column;
gap:16px;
}
.drawer.open{
display:flex;
}

.drawer-header{
display:flex;gap:12px;align-items:center;
}
.drawer-header .user-avatar{
width:56px;height:56px;border-radius:50%;
border:1px solid #e2e8f0;
}
.drawer-close{
margin-left:auto;
font-size:22px;
cursor:pointer;
background:transparent;
border:0;
color:inherit;
padding:0;
}

.drawer-actions a,
.drawer-actions button{
display:block;
padding:10px;
border-radius:10px;
border:1px solid #e2e8f0;
background:#f8fafc;
text-decoration:none;
color:#0f172a;
font-weight:600;
margin-bottom:8px;
}

/* AUTH MODAL */
.auth-modal{
position:fixed;inset:0;
background:rgba(0,0,0,.5);
display:none;
justify-content:center;
align-items:center;
z-index:999;
}
.auth-card{
background:white;
padding:24px;
border-radius:18px;
width:380px;
}

footer{
margin-top:40px;
padding:15px;
text-align:center;
background:#1e293b;
color:white;
}

@media (max-width: 600px){
.drawer{
width:min(320px, 86vw);
border-radius:18px 0 0 18px;
}
.container{padding:14px;margin:18px auto;}
.hero{grid-template-columns:1fr;gap:16px;}
.hero-title{font-size:24px;line-height:1.2;}
.hero-lead{font-size:14px;}
.hero-actions{gap:8px;}
.cta-btn,.ghost-btn{width:100%;justify-content:center;}
.overview-card{padding:14px;}
.overview-metric span{font-size:24px;}
.auth-section{padding:16px;}
.showcase-grid{grid-template-columns:1fr;}
.showcase-panel{padding:14px;}
.balance-container{padding:18px;}
.balance-container h1{font-size:28px;}
}
</style>
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
<div class="logo">
<img src="{% static 'tracker/logo.png' %}" class="logo-img">
<div class="logo-stack">
<span class="logo-title">Expense Tracker</span>
<span class="logo-slogan">Track every rupee, stay in control</span>
</div>
</div>

{% if request.user.is_authenticated %}
<button type="button" class="user-link" id="openDrawerBtn" aria-label="Open profile menu">
<span class="user-avatar" role="img" aria-label="Profile" style="background-image:url('{{ request.user.profile.profile_image_url }}'),url('{% static 'tracker/default-avatar.png' %}');"></span>
</button>
{% else %}
<a class="auth-btn" href="{% url 'get_started' %}">Get Started</a>
{% endif %}
</div>

<div class="container">

{% if not request.user.is_authenticated %}
<section class="hero">
<div>
<div class="preview-pill">App Overview</div>
<h1 class="hero-title">Track every rupee with a clear daily view</h1>
<p class="hero-lead">Add income and expenses, monitor your balance, and review monthly spending trends in seconds.</p>
<div class="hero-actions">
<a class="cta-btn" href="#auth-section">Explore Features</a>
</div>
</div>
<div class="overview-card">
<div class="overview-header">
<div class="overview-title">This Month Overview</div>
<span class="overview-chip">Preview</span>
</div>
<div class="overview-metric">
<span>&#8377;12,480</span>
<small>Balance after income and expenses</small>
</div>
<div class="overview-list">
<div class="overview-row">
<div>
<b>Salary</b><br>
<small>Feb 12</small>
</div>
<span class="overview-badge badge-income">+&#8377;18,450</span>
</div>
<div class="overview-row">
<div>
<b>Food</b><br>
<small>Feb 10</small>
</div>
<span class="overview-badge badge-expense">-&#8377;1,250</span>
</div>
<div class="overview-row">
<div>
<b>Transport</b><br>
<small>Feb 08</small>
</div>
<span class="overview-badge badge-expense">-&#8377;680</span>
</div>
</div>
</div>
</section>
{% endif %}

<div class="balance-container">
{% if not request.user.is_authenticated %}
<div class="preview-pill">Preview</div>
{% endif %}
<h2>{% if request.user.is_authenticated %}Your Balance{% else %}Monthly Snapshot{% endif %}</h2>
<h1>&#8377;{% if request.user.is_authenticated %}{{ balance }}{% else %}12480{% endif %}</h1>
<div class="summary">
<div class="summary-box income">
<h3>Income</h3>
<p>&#8377;{% if request.user.is_authenticated %}{{ total_income }}{% else %}18450{% endif %}</p>
</div>
<div class="summary-box expense">
<h3>Expense</h3>
<p>&#8377;{% if request.user.is_authenticated %}{{ total_expense }}{% else %}5970{% endif %}</p>
</div>
</div>
</div>

{% if not request.user.is_authenticated %}
<section id="auth-section" class="auth-section">
<div class="showcase-grid">
<div class="showcase-copy">
<div class="preview-pill">Quick Tour</div>
<h2>Plan your money without the clutter</h2>
<p class="showcase-lead">Use the Get Started button above to login or create your account. Here is what you can do next.</p>
<div class="showcase-steps">
<div class="showcase-step">
<div class="step-num">1</div>
<div>
<b>Add transactions</b>
<p>Log income and expenses in seconds.</p>
</div>
</div>
<div class="showcase-step">
<div class="step-num">2</div>
<div>
<b>Track your balance</b>
<p>See totals and category spending at a glance.</p>
</div>
</div>
<div class="showcase-step">
<div class="step-num">3</div>
<div>
<b>Stay organized</b>
<p>Filter by month and review your progress.</p>
</div>
</div>
</div>
</div>

<div class="showcase-panel">
<div class="panel-title">Secure and simple</div>
<div class="panel-metric">
<span>OTP Login</span>
<small>Gmail verification</small>
</div>
<div class="panel-list">
<div class="panel-row">
<span>Fast entry</span>
<span class="panel-chip">Mobile ready</span>
</div>
<div class="panel-row">
<span>Monthly insights</span>
<span class="panel-chip">Filters</span>
</div>
<div class="panel-row">
<span>Visual reports</span>
<span class="panel-chip">Charts</span>
</div>
</div>
<div class="security-badges">
<span class="security-badge">Secure OTP</span>
<span class="security-badge">No Ads</span>
<span class="security-badge">Private</span>
</div>
</div>
</div>
</section>
{% endif %}

{% if request.user.is_authenticated %}

<div class="filter-bar">
<form method="get" class="filter-form">
<label for="monthFilter">Filter by month</label>
<input type="month" id="monthFilter" name="month" value="{{ selected_month }}">
<button type="submit">Filter</button>
</form>
{% if selected_month %}
<a class="filter-clear" href="{% url 'home' %}">Clear</a>
{% endif %}
</div>

<form method="POST" class="form-card">
{% csrf_token %}
<select name="type"><option value="income">Income</option><option value="expense">Expense</option></select>
<select name="payment_mode"><option value="online">Online Money</option><option value="cash">Cash Money</option></select>
<input type="number" name="amount" placeholder="Amount" required>
<select name="category">
<option value="food">Food</option>
<option value="transport">Transport</option>
<option value="rent">Rent</option>
<option value="shopping">Shopping</option>
<option value="salary">Salary</option>
<option value="other">Other</option>
</select>
<input type="date" name="date" required>
<button>Add</button>
</form>

<ul>
{% for t in transactions %}
<li class="{{ t.type }}">
<span>{{ t.date }} &mdash; {{ t.get_category_display }}</span>
<span>&#8377;{{ t.amount }} <a href="/delete/{{ t.id }}/">&times;</a></span>
</li>
{% endfor %}
</ul>

{% if chart_values %}
<div class="chart-box">
<canvas id="expenseChart"></canvas>
</div>
<script>
new Chart(document.getElementById('expenseChart'),{
type:'pie',
data:{
labels: JSON.parse('{{ chart_labels|escapejs }}'),
datasets:[{data: JSON.parse('{{ chart_values|escapejs }}')}]
}
});
</script>
{% endif %}

{% endif %}
</div>

<!-- PROFILE DRAWER -->
{% if request.user.is_authenticated %}
<div id="drawerScrim" class="drawer-scrim"></div>

<aside id="profileDrawer" class="drawer">
<div class="drawer-header">
<span class="user-avatar" role="img" aria-label="Profile" style="background-image:url('{{ request.user.profile.profile_image_url }}'),url('{% static 'tracker/default-avatar.png' %}');"></span>
<div>
<b>{{ request.user.profile.full_name }}</b><br>
<small>{{ request.user.email }}</small>
</div>
<button type="button" class="drawer-close" id="drawerClose" aria-label="Close profile menu">&times;</button>
</div>

<div class="drawer-actions">
<a href="{% url 'profile' %}">View Profile</a>
<a href="{% url 'edit_profile' %}">Edit Profile</a>
<a href="{% url 'password_change' %}">Change Password</a>
<a href="{% url 'forgot_password' %}">Forgot Password (OTP)</a>
<form method="post" action="{% url 'logout' %}">
{% csrf_token %}
<button type="submit">Sign Out</button>
</form>
</div>
</aside>
{% endif %}


<footer>
This website made by Priyanshu Chatterjee BN & Rohit Sikder&copy; 2026
</footer>

<script>
function toggleDrawer(open){
const d=document.getElementById("profileDrawer");
const s=document.getElementById("drawerScrim");
if(!d||!s)return;
if(open){
  d.classList.add("open");
  s.classList.add("open");
}else{
  d.classList.remove("open");
  s.classList.remove("open");
}
}

document.addEventListener("DOMContentLoaded",()=>{
  const openBtn=document.getElementById("openDrawerBtn");
  const closeBtn=document.getElementById("drawerClose");
  const scrim=document.getElementById("drawerScrim");

  if(openBtn){
    openBtn.addEventListener("click",()=>toggleDrawer(true));
    openBtn.addEventListener("touchstart",e=>{e.preventDefault();toggleDrawer(true);},{passive:false});
  }
  if(closeBtn){
    closeBtn.addEventListener("click",()=>toggleDrawer(false));
  }
  if(scrim){
    scrim.addEventListener("click",()=>toggleDrawer(false));
    scrim.addEventListener("touchstart",e=>{e.preventDefault();toggleDrawer(false);},{passive:false});
  }

  // auth section is decorative on the landing page now
});

document.addEventListener("keydown",e=>{
if(e.key==="Escape") toggleDrawer(false);
});
</script>

</body>
</html>
