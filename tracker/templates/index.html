{% load static %}
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Expense Tracker</title>
<link rel="icon" type="image/png" href="{% static 'tracker/logo.png' %}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
--primary:#4f46e5;
--secondary:#3b82f6;
--accent:#22c55e;
--bg:#f4f7fb;
--card:#ffffff;
--shadow:0 15px 35px rgba(0,0,0,.12);
}

*{box-sizing:border-box;}
body{
margin:0;
font-family:"Segoe UI",sans-serif;
background:radial-gradient(1200px 600px at 10% -10%, #dbeafe 0%, transparent 60%),
radial-gradient(1200px 700px at 110% 10%, #e0e7ff 0%, transparent 60%),
linear-gradient(120deg,#eef2ff,#f8fafc);
color:#0f172a;
overflow-x:hidden;
 -webkit-text-size-adjust:100%;
}
img,canvas{max-width:100%;height:auto;}

/* ATMOSPHERE */
.bg-orb{
position:fixed;
width:420px;
height:420px;
border-radius:50%;
background:radial-gradient(circle at 30% 30%, rgba(99,102,241,.35), rgba(59,130,246,.08) 60%, transparent 70%);
filter:blur(2px);
z-index:0;
animation:floaty 12s ease-in-out infinite;
}
.bg-orb.orb-2{
width:520px;height:520px;
right:-160px;top:120px;
background:radial-gradient(circle at 70% 30%, rgba(34,197,94,.25), rgba(59,130,246,.08) 60%, transparent 70%);
animation-delay:2s;
}
.bg-orb.orb-1{
left:-160px;top:-120px;
}
@keyframes floaty{
0%{transform:translateY(0);}50%{transform:translateY(22px);}100%{transform:translateY(0);}
}

/* TOP BAR */
.topbar{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 8px 25px rgba(0,0,0,.25);
 flex-wrap:wrap;
 gap:10px 16px;
}
.logo{font-size:22px;font-weight:bold;display:flex;align-items:center;gap:10px;}
.logo-img{width:38px;height:38px;object-fit:cover;border-radius:50%;background:rgba(255,255,255,.9);padding:2px;filter:drop-shadow(0 4px 10px rgba(0,0,0,.25));}
.slogan{font-size:12px;opacity:.9;}
.user-area{display:flex;align-items:center;gap:12px;font-weight:600;}
.user-link{
display:flex;
align-items:center;
gap:10px;
color:white;
text-decoration:none;
font-weight:600;
}
.user-link:hover{opacity:.9;}
.user-avatar{
width:36px;
height:36px;
border-radius:50%;
object-fit:cover;
border:2px solid rgba(255,255,255,.8);
box-shadow:0 6px 14px rgba(0,0,0,.2);
}
.auth-btn{
background:white;
color:var(--primary);
padding:8px 18px;
border-radius:20px;
border:none;
font-weight:600;
cursor:pointer;
transition:.3s;
}
.auth-btn:hover{transform:scale(1.05);}

/* HERO */
.hero{
padding:100px 20px;
text-align:center;
}
.hero h1{font-size:48px;margin-bottom:10px;}
.hero p{font-size:18px;opacity:.8;}
.hero button{
margin-top:25px;
padding:14px 30px;
border:none;
border-radius:30px;
font-size:18px;
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
cursor:pointer;
transition:.3s;
}
.hero button:hover{transform:scale(1.05);}

/* CONTAINER */
.container{
padding:25px;
max-width:1200px;
margin:auto;
}

/* FORM */
.form-card{
background:white;
padding:15px;
border-radius:18px;
box-shadow:var(--shadow);
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:15px;
}
.form-card input,.form-card select{
padding:10px;border-radius:10px;border:1px solid #ccc;
}
.form-card button{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;border:none;padding:10px 20px;
border-radius:12px;cursor:pointer;
}


/* FORMS ENHANCED */
.section-title{
font-size:16px;
font-weight:700;
margin:6px 0 12px;
color:#0f172a;
display:flex;
align-items:center;
gap:8px;
}
.section-title span{
font-size:12px;
font-weight:600;
color:#64748b;
background:#eef2ff;
padding:4px 8px;
border-radius:999px;
}
.form-card{
background:linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);
}
.form-grid{
display:grid;
grid-template-columns:1.1fr 1.2fr 1fr 1fr auto;
gap:12px;
width:100%;
}
.input-group{
position:relative;
}
.input-group label{
position:absolute;
left:12px;
top:-8px;
background:white;
padding:0 6px;
font-size:11px;
color:#64748b;
}
.form-card input,.form-card select{
width:100%;
background:white;
border:1px solid #e2e8f0;
box-shadow:0 4px 14px rgba(15,23,42,.06);
}
.form-card input:focus,.form-card select:focus{
outline:none;
border-color:#6366f1;
box-shadow:0 0 0 3px rgba(99,102,241,.18);
}
.form-card button{
align-self:end;
box-shadow:0 10px 20px rgba(79,70,229,.25);
}
.form-actions{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:10px;
width:100%;
}
.form-hint{
font-size:12px;
color:#64748b;
}
.filter-card{
background:linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);
display:flex;
justify-content:space-between;
align-items:center;
gap:12px;
}
.filter-card .input-group{
flex:1;
}
@media (max-width: 900px){
.form-grid{
grid-template-columns:1fr 1fr;
}
.form-card button{
width:100%;
}
}
@media (max-width: 760px){
.user-area{width:100%;justify-content:flex-start;}
.user-link span{display:none;}
.profile-card{
flex-direction:column;
align-items:flex-start;
gap:12px;
}
.profile-actions{
margin-left:0;
width:100%;
}
.profile-actions a{
display:block;
text-align:center;
}
.stats{grid-template-columns:1fr;gap:12px;}
.stats.stats-2{grid-template-columns:1fr;}
.chart-box{max-width:100%;padding:16px;}
li{
flex-direction:column;
align-items:flex-start;
gap:6px;
}
li span:last-child{
width:100%;
display:flex;
justify-content:space-between;
}
}
@media (max-width: 600px){
.form-grid{
grid-template-columns:1fr;
}
.form-actions{
flex-direction:column;
align-items:flex-start;
gap:6px;
}
.container{padding:18px;}
.topbar{padding:12px 16px;}
.logo{font-size:18px;}
.logo-img{width:32px;height:32px;}
.slogan{font-size:11px;}
.auth-btn{padding:6px 12px;font-size:13px;border-radius:16px;}
.hero{padding:70px 16px;}
.hero h1{font-size:30px;}
.hero p{font-size:14px;}
.hero button{padding:10px 18px;font-size:14px;border-radius:22px;}
.form-card button{width:auto;padding:8px 14px;font-size:13px;border-radius:10px;}
.filter-card{padding:12px 14px;}
.filter-card button{padding:8px 12px;font-size:13px;border-radius:10px;}
.profile-actions a{padding:6px 10px;font-size:12px;border-radius:10px;}
.drawer-actions a,.drawer-actions button{padding:8px 10px;font-size:13px;}
.stats{grid-template-columns:1fr;gap:10px;}
.stats.stats-2{grid-template-columns:1fr;}
.card{padding:16px;font-size:15px;border-radius:14px;}
.count{font-size:20px;}
 button,input,select,textarea{font-size:16px;}
}

/* FILTER */
.filter-card{
background:linear-gradient(90deg, rgba(255,255,255,.9), rgba(248,250,252,.9));
padding:14px 16px;
border-radius:18px;
box-shadow:0 16px 35px rgba(15,23,42,.12);
margin-bottom:18px;
position:relative;
overflow:hidden;
}
.filter-card:before{
content:"";
position:absolute;
inset:0;
background:radial-gradient(140px 60px at 15% 50%, rgba(99,102,241,.18), transparent 70%);
opacity:.8;
pointer-events:none;
}
.filter-card button{
background:linear-gradient(135deg,#0ea5e9,#6366f1);
color:white;
border:none;
padding:10px 18px;
border-radius:12px;
box-shadow:0 10px 20px rgba(59,130,246,.25);
}
.filter-card button:hover{transform:translateY(-1px);}
.filter-chip{
font-size:12px;
color:#1e3a8a;
background:#e0e7ff;
padding:4px 10px;
border-radius:999px;
font-weight:700;
}

/* STATS */
.stats{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:15px;
margin-bottom:20px;
}
.stats.stats-2{
grid-template-columns:repeat(2,1fr);
}
.card{
padding:22px;
border-radius:18px;
text-align:center;
font-weight:bold;
font-size:17px;
box-shadow:var(--shadow);
}
.card:nth-child(1){background:#dcfce7;color:#166534;}
.card:nth-child(2){background:#fee2e2;color:#991b1b;}
.card:nth-child(3){background:#e0e7ff;color:#3730a3;}
.count{font-size:24px;display:block;margin-top:6px;}

/* LIST */
ul{list-style:none;padding:0;}
li{
background:white;
margin-bottom:10px;
padding:14px;
border-radius:14px;
display:flex;
justify-content:space-between;
align-items:center;
box-shadow:0 6px 15px rgba(0,0,0,.1);
}
li a{color:red;text-decoration:none;font-weight:bold;}

/* CHART */
.chart-box{
background:white;
padding:20px;
border-radius:22px;
box-shadow:var(--shadow);
max-width:450px;
margin:30px auto;
}
.profile-card{
background:white;
padding:18px;
border-radius:18px;
box-shadow:var(--shadow);
display:flex;
align-items:center;
gap:16px;
margin-bottom:15px;
}
.profile-card img{
width:64px;
height:64px;
border-radius:50%;
object-fit:cover;
border:2px solid #e2e8f0;
}
.profile-meta{
display:flex;
flex-direction:column;
gap:4px;
}
.profile-meta .name{font-size:18px;font-weight:700;}
.profile-meta .email{font-size:13px;opacity:.7;}
.profile-actions{
margin-left:auto;
}
.profile-actions a{
background:linear-gradient(135deg,var(--primary),var(--secondary));
color:white;
padding:8px 14px;
border-radius:12px;
text-decoration:none;
font-weight:600;
font-size:14px;
}


.drawer-scrim{
position:fixed;
inset:0;
background:rgba(15,23,42,.35);
opacity:0;
pointer-events:none;
transition:opacity .25s ease;
z-index:998;
}
.drawer{
position:fixed;
top:0;
right:0;
height:100%;
width:min(360px,85vw);
background:white;
box-shadow:-10px 0 30px rgba(0,0,0,.2);
transform:translateX(100%);
transition:transform .3s ease;
z-index:999;
display:flex;
flex-direction:column;
padding:22px;
}
.drawer.open{transform:translateX(0);}
.drawer-scrim.open{opacity:1;pointer-events:auto;}
.drawer-header{
display:flex;
align-items:center;
gap:12px;
margin-bottom:16px;
}
.drawer-header img{
width:52px;height:52px;border-radius:50%;object-fit:cover;
border:2px solid #e2e8f0;
}
.drawer-title{
display:flex;flex-direction:column;gap:2px;
}
.drawer-title .name{font-weight:700;font-size:18px;}
.drawer-title .email{font-size:13px;opacity:.7;}
.drawer-actions{
margin-top:8px;
display:flex;
flex-direction:column;
gap:10px;
}
.drawer-actions form{margin:0;}
.drawer-actions a,.drawer-actions button{
text-align:left;
padding:10px 12px;
border-radius:12px;
border:1px solid #e2e8f0;
background:#f8fafc;
text-decoration:none;
color:#0f172a;
font-weight:600;
cursor:pointer;
}
.drawer-actions a:hover,.drawer-actions button:hover{background:#eef2ff;}
.drawer-close{
margin-left:auto;
font-size:22px;
cursor:pointer;
line-height:1;
}

/* AUTH MODAL */
.auth-modal{
position:fixed;inset:0;
background:radial-gradient(circle at 20% 20%, rgba(79,70,229,.25), transparent 45%),
rgba(15,23,42,.55);
backdrop-filter:blur(2px);
display:none;
justify-content:center;
align-items:center;
z-index:999;
}
.auth-card{
background:linear-gradient(180deg,#ffffff 0%, #f8fafc 100%);
padding:28px 26px 24px;
border-radius:24px;
width:min(420px,92vw);
text-align:left;
box-shadow:0 30px 80px rgba(15,23,42,.35);
animation:pop .35s ease;
position:relative;
}
.auth-card h2{margin:6px 0 4px;font-size:24px;color:#0f172a;}
.auth-card p{opacity:.8;font-size:14px;margin:0 0 16px;color:#334155;}
.auth-card small{display:block;color:#64748b;margin-top:8px;font-size:12px;}
.auth-card input{
width:100%;
padding:12px 14px;
margin-top:12px;
border-radius:12px;
border:1px solid #e2e8f0;
background:#fff;
font-size:15px;
transition:border .2s, box-shadow .2s;
}
.auth-card input:focus{
outline:none;
border-color:#6366f1;
box-shadow:0 0 0 3px rgba(99,102,241,.2);
}
.auth-card button{
margin-top:16px;
width:100%;
padding:12px 14px;
border:none;
border-radius:14px;
background:linear-gradient(135deg,#4f46e5,#3b82f6);
color:white;
font-size:16px;
font-weight:700;
cursor:pointer;
transition:transform .2s, box-shadow .2s;
box-shadow:0 12px 24px rgba(79,70,229,.25);
}
.auth-card button:hover{transform:translateY(-1px);box-shadow:0 16px 28px rgba(79,70,229,.28);} 
.close-auth{
position:absolute;
right:14px;
top:12px;
font-size:18px;
width:32px;
height:32px;
border-radius:10px;
display:flex;
align-items:center;
justify-content:center;
background:#eef2ff;
color:#4338ca;
cursor:pointer;
}
.auth-tabs{
display:flex;
background:#eef2ff;
border-radius:14px;
padding:4px;
margin-bottom:14px;
}
.auth-tab{
flex:1;
padding:10px;
border:none;
font-weight:700;
cursor:pointer;
background:transparent;
color:#334155;
border-radius:10px;
}
.auth-tab.active{
background:white;
color:#1e1b4b;
box-shadow:0 6px 14px rgba(79,70,229,.2);
}
.auth-panel{display:none;}
.auth-panel.active{display:block;}


/* MOTION */
.reveal{opacity:0;transform:translateY(12px);animation:reveal .6s ease forwards;}
.reveal.delay-1{animation-delay:.08s;}
.reveal.delay-2{animation-delay:.16s;}
.reveal.delay-3{animation-delay:.24s;}
@keyframes reveal{to{opacity:1;transform:translateY(0);}}

.float{animation:floaty 8s ease-in-out infinite;}

.card{transition:transform .2s ease, box-shadow .2s ease;}
.card:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(15,23,42,.18);}

li{transition:transform .2s ease, box-shadow .2s ease;}
li:hover{transform:translateY(-2px);}

.hero h1{letter-spacing:-.5px;}
.hero{position:relative;z-index:1;}
.hero:after{content:"";position:absolute;inset:auto 0 -30px 0;height:1px;background:linear-gradient(90deg,transparent,#c7d2fe,transparent);}

.topbar{position:sticky;top:0;z-index:10;}

.form-card,.filter-card,.chart-box,.profile-card,ul li{backdrop-filter:blur(2px);}

/* FOOTER */
footer{
margin-top:60px;
padding:15px;
text-align:center;
background:#1e293b;
color:white;
}

/* ANIMATIONS */
@keyframes pop{
from{transform:scale(.7);opacity:0;}
to{transform:scale(1);opacity:1;}
}
</style>
</head>

<body>
<div class="bg-orb orb-1"></div>
<div class="bg-orb orb-2"></div>
<div class="page-shell">
<div class="topbar">
<div>
<div class="logo">
<img src="{% static 'tracker/logo.png' %}" alt="Expense Tracker Logo" class="logo-img" onerror="this.onerror=null;this.src='{% static 'tracker/logo_clean.png' %}';">
<span>Expense Tracker</span>
</div>
<div class="slogan">Track every rupee. Control your future.</div>
</div>
<div class="user-area">
{% if request.user.is_authenticated %}
<div class="user-link" onclick="toggleDrawer(true)" role="button" tabindex="0" aria-haspopup="dialog" aria-expanded="false">
<img class="user-avatar" src="{{ request.user.profile.profile_image_url }}" alt="Profile photo" onerror="this.onerror=null;this.src='{% static 'tracker/logo.png' %}';">
<span>{{ request.user.username }}</span>
</div>
{% else %}
<button class="auth-btn" onclick="openAuth()">Login / Sign Up</button>
{% endif %}
</div>
</div>

{% if not request.user.is_authenticated %}
<div class="hero reveal">
<h1>Manage Your Money Smartly</h1>
<p>Track income, control expenses & build savings effortlessly.</p>
<button onclick="openAuth()">Get Started</button>
</div>
{% endif %}

{% if request.user.is_authenticated %}
<div class="container reveal">

<div class="profile-card reveal delay-1">
<img src="{{ request.user.profile.profile_image_url }}" alt="Profile photo" onerror="this.onerror=null;this.src='{% static 'tracker/logo.png' %}';">
<div class="profile-meta">
<span class="name">{{ request.user.profile.full_name }}</span>
<span class="email">{{ request.user.email }}</span>
</div>
<div class="profile-actions">
<a href="{% url 'edit_profile' %}">Edit Profile</a>
</div>
</div>

<form method="POST" class="form-card reveal delay-2">
{% csrf_token %}
<select name="type">
<option value="income">Income</option>
<option value="expense">Expense</option>
</select>
<select name="payment_mode">
<option value="online">Online Money</option>
<option value="cash">Cash Money</option>
</select>
<input type="number" name="amount" placeholder="Amount" required>
<select name="category">
<option value="food">Food</option><option value="transport">Transport</option><option value="rent">Rent</option>
<option value="shopping">Shopping</option><option value="salary">Salary</option><option value="other">Other</option>
</select>
<input type="date" name="date" required>
<button>Add</button>
</form>

<form method="GET" class="filter-card reveal delay-3">
<input type="month" name="month" value="{{ selected_month }}">
<button>Filter</button>
</form>

<div class="stats reveal">
<div class="card">Income <span class="count">{{ total_income }}</span></div>
<div class="card">Expense <span class="count">{{ total_expense }}</span></div>
<div class="card">Balance <span class="count">{{ balance }}</span></div>
</div>

<div class="stats stats-2 reveal">
<div class="card">Online Balance <span class="count">{{ online_balance }}</span></div>
<div class="card">Cash Balance <span class="count">{{ cash_balance }}</span></div>
</div>

<ul class="reveal">
{% for t in transactions %}
<li class="reveal" style="animation-delay: {{ forloop.counter0|add:1 }}0ms">
<span>{{ t.date }} | {{ t.get_category_display }} | {{ t.type }}</span>
<span>₹{{ t.amount }} <a href="/delete/{{ t.id }}/">✖</a></span>
</li>
{% endfor %}
</ul>

{% if chart_values %}
<div class="chart-box reveal">
<canvas id="expenseChart"></canvas>
</div>
<script>
const labels = JSON.parse('{{ chart_labels|escapejs }}');
const values = JSON.parse('{{ chart_values|escapejs }}');
new Chart(document.getElementById('expenseChart'),{
type:'pie',
data:{labels:labels,datasets:[{data:values}]},
options:{plugins:{legend:{position:'bottom'}}}
});
</script>
{% endif %}

</div>
{% endif %}

<!-- AUTH MODAL -->
<div id="authModal" class="auth-modal">
<div class="auth-card">
<span class="close-auth" onclick="closeAuth()">x</span>
<h2>Welcome Back</h2>
<p>Login or create a new account</p>

<div class="auth-tabs">
<button class="auth-tab active" type="button" onclick="switchAuth('login')">Login</button>
<button class="auth-tab" type="button" onclick="switchAuth('signup')">Create Account</button>
</div>

<div id="loginPanel" class="auth-panel active">
<form method="post" action="{% url 'email_login' %}">
{% csrf_token %}
<input type="hidden" name="mode" value="login">
<input type="email" name="email" placeholder="Gmail" required>
<small>We will send an OTP to your email</small>
<button>Send OTP</button>
</form>
</div>

<div id="signupPanel" class="auth-panel">
<form method="post" action="{% url 'email_login' %}">
{% csrf_token %}
<input type="hidden" name="mode" value="signup">
<input type="text" name="full_name" placeholder="Full Name" required>
<input type="email" name="email" placeholder="Gmail" required>
<input type="password" name="password" placeholder="Password" required>
<input type="password" name="confirm_password" placeholder="Confirm Password" required>
<button>Create Account & Send OTP</button>
</form>
</div>

</div>
</div>

{% if request.user.is_authenticated %}
<div id="drawerScrim" class="drawer-scrim" onclick="toggleDrawer(false)"></div>
<aside id="profileDrawer" class="drawer" aria-hidden="true">
<div class="drawer-header">
<img src="{{ request.user.profile.profile_image_url }}" alt="Profile photo" onerror="this.onerror=null;this.src='{% static 'tracker/logo.png' %}';">
<div class="drawer-title">
<span class="name">{{ request.user.profile.full_name }}</span>
<span class="email">{{ request.user.email }}</span>
</div>
<span class="drawer-close" onclick="toggleDrawer(false)">x</span>
</div>
<div class="drawer-actions">
<a href="{% url 'profile' %}" style="--delay:40ms">View Profile</a>
<a href="{% url 'edit_profile' %}" style="--delay:90ms">Edit Profile</a>
<form method="post" action="{% url 'logout' %}" style="--delay:140ms">
{% csrf_token %}
<button type="submit">Sign Out</button>
</form>
</div>
</aside>
{% endif %}

<footer>
This website made by Priyanshu Chatterjee BN © 2026
</footer>

<script>
function openAuth(){
document.getElementById("authModal").style.display="flex";
}
function closeAuth(){
document.getElementById("authModal").style.display="none";
}

function switchAuth(mode){
const loginPanel = document.getElementById("loginPanel");
const signupPanel = document.getElementById("signupPanel");
const tabs = document.querySelectorAll(".auth-tab");
if(!loginPanel || !signupPanel || tabs.length < 2){return;}
if(mode === "login"){
loginPanel.classList.add("active");
signupPanel.classList.remove("active");
tabs[0].classList.add("active");
tabs[1].classList.remove("active");
}else{
loginPanel.classList.remove("active");
signupPanel.classList.add("active");
tabs[0].classList.remove("active");
tabs[1].classList.add("active");
}
}

function toggleDrawer(open){
const drawer = document.getElementById("profileDrawer");
const scrim = document.getElementById("drawerScrim");
if(!drawer || !scrim){return;}
if(open){
drawer.classList.add("open");
scrim.classList.add("open");
drawer.setAttribute("aria-hidden","false");
const trigger = document.querySelector(".user-link");
if(trigger){trigger.setAttribute("aria-expanded","true");}
}else{
drawer.classList.remove("open");
scrim.classList.remove("open");
drawer.setAttribute("aria-hidden","true");
const trigger = document.querySelector(".user-link");
if(trigger){trigger.setAttribute("aria-expanded","false");}
}
}

document.addEventListener("keydown",(e)=>{
if(e.key==="Escape"){toggleDrawer(false);}
});
const userLink = document.querySelector(".user-link");
if(userLink){
userLink.addEventListener("keydown",(e)=>{
if(e.key==="Enter" || e.key===" "){
e.preventDefault();
toggleDrawer(true);
}
});
}

/* count animation */
document.querySelectorAll(".count").forEach(el=>{
let target=parseInt(el.innerText)||0;
let c=0,step=Math.max(1,Math.ceil(target/40));
let i=setInterval(()=>{
c+=step;
if(c>=target){c=target;clearInterval(i);}
el.innerText=c;
},25);
});
</script>

</div>
</body>
</html>
